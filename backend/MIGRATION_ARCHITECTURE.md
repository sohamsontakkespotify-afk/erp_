# Migration System Architecture

## System Overview

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     ERP Application Startup                      ‚îÇ
‚îÇ                         (app.py)                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  initialize_database(app)                        ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Step 1: Run Custom Migrations                                  ‚îÇ
‚îÇ  Step 2: Create SQLAlchemy Model Tables                         ‚îÇ
‚îÇ  Step 3: Add Missing Columns                                    ‚îÇ
‚îÇ  Step 4: Create Admin User                                      ‚îÇ
‚îÇ  Step 5: Add Sample Data                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              init_migrations(app, db)                            ‚îÇ
‚îÇ           (utils/migration_manager.py)                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  MigrationManager                                ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚Ä¢ Connects to database                                         ‚îÇ
‚îÇ  ‚Ä¢ Checks for existing tables                                   ‚îÇ
‚îÇ  ‚Ä¢ Runs migrations in order                                     ‚îÇ
‚îÇ  ‚Ä¢ Handles errors gracefully                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ  run_all_migrations()       ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                    ‚îÇ                    ‚îÇ
        ‚ñº                    ‚ñº                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Sales      ‚îÇ    ‚îÇ     HR       ‚îÇ    ‚îÇ   Fleet      ‚îÇ
‚îÇ  Migration   ‚îÇ    ‚îÇ  Migration   ‚îÇ    ‚îÇ  Migration   ‚îÇ
‚îÇ              ‚îÇ    ‚îÇ              ‚îÇ    ‚îÇ              ‚îÇ
‚îÇ ‚Ä¢ sales_     ‚îÇ    ‚îÇ ‚Ä¢ employees  ‚îÇ    ‚îÇ ‚Ä¢ vehicle    ‚îÇ
‚îÇ   order      ‚îÇ    ‚îÇ ‚Ä¢ attendance ‚îÇ    ‚îÇ ‚Ä¢ transport_ ‚îÇ
‚îÇ ‚Ä¢ customer   ‚îÇ    ‚îÇ ‚Ä¢ leaves     ‚îÇ    ‚îÇ   job        ‚îÇ
‚îÇ ‚Ä¢ sales_     ‚îÇ    ‚îÇ ‚Ä¢ payrolls   ‚îÇ    ‚îÇ              ‚îÇ
‚îÇ   transaction‚îÇ    ‚îÇ ‚Ä¢ job_*      ‚îÇ    ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                    ‚îÇ                    ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   Dispatch   ‚îÇ
                    ‚îÇ  Migration   ‚îÇ
                    ‚îÇ              ‚îÇ
                    ‚îÇ ‚Ä¢ Updates    ‚îÇ
                    ‚îÇ   dispatch_  ‚îÇ
                    ‚îÇ   request    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ Guest List   ‚îÇ
                    ‚îÇ  Migration   ‚îÇ
                    ‚îÇ              ‚îÇ
                    ‚îÇ ‚Ä¢ guest_list ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Migration Flow Sequence

```
1. Application Starts
   ‚îî‚îÄ> python app.py

2. Create Flask App
   ‚îî‚îÄ> create_app()
       ‚îú‚îÄ> Load configuration
       ‚îú‚îÄ> Initialize database (db.init_app)
       ‚îú‚îÄ> Initialize mail
       ‚îî‚îÄ> Register blueprints

3. Initialize Database
   ‚îî‚îÄ> initialize_database(app)
       ‚îÇ
       ‚îú‚îÄ> [STEP 1] Run Custom Migrations
       ‚îÇ   ‚îî‚îÄ> init_migrations(app, db)
       ‚îÇ       ‚îî‚îÄ> MigrationManager.run_all_migrations()
       ‚îÇ           ‚îú‚îÄ> Check database connection
       ‚îÇ           ‚îú‚îÄ> run_sales_migration()
       ‚îÇ           ‚îÇ   ‚îú‚îÄ> CREATE TABLE IF NOT EXISTS sales_order
       ‚îÇ           ‚îÇ   ‚îú‚îÄ> CREATE TABLE IF NOT EXISTS customer
       ‚îÇ           ‚îÇ   ‚îî‚îÄ> CREATE TABLE IF NOT EXISTS sales_transaction
       ‚îÇ           ‚îÇ
       ‚îÇ           ‚îú‚îÄ> run_hr_migration()
       ‚îÇ           ‚îÇ   ‚îú‚îÄ> CREATE TABLE IF NOT EXISTS employees
       ‚îÇ           ‚îÇ   ‚îú‚îÄ> CREATE TABLE IF NOT EXISTS attendance
       ‚îÇ           ‚îÇ   ‚îú‚îÄ> CREATE TABLE IF NOT EXISTS leaves
       ‚îÇ           ‚îÇ   ‚îú‚îÄ> CREATE TABLE IF NOT EXISTS payrolls
       ‚îÇ           ‚îÇ   ‚îú‚îÄ> CREATE TABLE IF NOT EXISTS performance_reviews
       ‚îÇ           ‚îÇ   ‚îú‚îÄ> CREATE TABLE IF NOT EXISTS job_postings
       ‚îÇ           ‚îÇ   ‚îú‚îÄ> CREATE TABLE IF NOT EXISTS job_applications
       ‚îÇ           ‚îÇ   ‚îú‚îÄ> CREATE TABLE IF NOT EXISTS interviews
       ‚îÇ           ‚îÇ   ‚îî‚îÄ> CREATE TABLE IF NOT EXISTS candidates
       ‚îÇ           ‚îÇ
       ‚îÇ           ‚îú‚îÄ> run_dispatch_migration()
       ‚îÇ           ‚îÇ   ‚îî‚îÄ> ALTER TABLE dispatch_request (add columns)
       ‚îÇ           ‚îÇ
       ‚îÇ           ‚îú‚îÄ> run_fleet_migration()
       ‚îÇ           ‚îÇ   ‚îú‚îÄ> CREATE TABLE IF NOT EXISTS vehicle
       ‚îÇ           ‚îÇ   ‚îî‚îÄ> CREATE TABLE IF NOT EXISTS transport_job
       ‚îÇ           ‚îÇ
       ‚îÇ           ‚îî‚îÄ> run_guest_list_migration()
       ‚îÇ               ‚îî‚îÄ> CREATE TABLE IF NOT EXISTS guest_list
       ‚îÇ
       ‚îú‚îÄ> [STEP 2] Create SQLAlchemy Model Tables
       ‚îÇ   ‚îî‚îÄ> db.create_all()
       ‚îÇ       ‚îú‚îÄ> user
       ‚îÇ       ‚îú‚îÄ> gate_users
       ‚îÇ       ‚îú‚îÄ> gate_entry_logs
       ‚îÇ       ‚îú‚îÄ> going_out_logs
       ‚îÇ       ‚îú‚îÄ> purchase_order
       ‚îÇ       ‚îú‚îÄ> showroom_product
       ‚îÇ       ‚îî‚îÄ> ... (all other models)
       ‚îÇ
       ‚îú‚îÄ> [STEP 3] Add Missing Columns
       ‚îÇ   ‚îî‚îÄ> ALTER TABLE purchase_order ADD COLUMN original_requirements
       ‚îÇ
       ‚îú‚îÄ> [STEP 4] Create Admin User
       ‚îÇ   ‚îî‚îÄ> User.create_admin_user()
       ‚îÇ       ‚îî‚îÄ> INSERT INTO user (username='admin', ...)
       ‚îÇ
       ‚îî‚îÄ> [STEP 5] Add Sample Data
           ‚îî‚îÄ> INSERT INTO showroom_product (...)

4. Start Flask Server
   ‚îî‚îÄ> app.run(host='0.0.0.0', port=5000)
```

## Key Components

### 1. MigrationManager Class

```python
class MigrationManager:
    - __init__(app, db)           # Initialize with Flask app
    - init_app(app, db)           # Set up database connection
    - column_exists()             # Check if column exists
    - table_exists()              # Check if table exists
    - run_sales_migration()       # Create sales tables
    - run_hr_migration()          # Create HR tables
    - run_dispatch_migration()    # Update dispatch tables
    - run_fleet_migration()       # Create fleet tables
    - run_guest_list_migration()  # Create guest list table
    - run_all_migrations()        # Execute all migrations
```

### 2. Migration Methods

Each migration method follows this pattern:

```python
def run_xxx_migration(self, connection):
    """Create xxx tables"""
    print("üîÑ Running xxx migration...")
    
    create_table_sql = """
    CREATE TABLE IF NOT EXISTS table_name (
        id INT AUTO_INCREMENT PRIMARY KEY,
        ...
    );
    """
    
    try:
        connection.execute(text(create_table_sql))
        connection.commit()
        print("‚úÖ xxx tables created successfully!")
        return True
    except Exception as e:
        print(f"‚ö†Ô∏è xxx migration error: {e}")
        return False
```

### 3. Safety Features

#### Idempotent Operations
```sql
CREATE TABLE IF NOT EXISTS ...
```
- Won't fail if table already exists
- Safe to run multiple times

#### Column Existence Check
```python
if not self.column_exists(connection, 'table', 'column'):
    connection.execute(text("ALTER TABLE table ADD COLUMN column ..."))
```
- Checks before adding columns
- Prevents duplicate column errors

#### Error Handling
```python
try:
    # Migration code
except Exception as e:
    print(f"‚ö†Ô∏è Migration error: {e}")
    return False
```
- Catches and logs errors
- Continues with other migrations

## Database Schema

### Sales Module Tables

```
sales_order
‚îú‚îÄ‚îÄ id (PK)
‚îú‚îÄ‚îÄ order_number (UNIQUE)
‚îú‚îÄ‚îÄ customer_name
‚îú‚îÄ‚îÄ showroom_product_id (FK)
‚îú‚îÄ‚îÄ payment_status
‚îî‚îÄ‚îÄ ...

customer
‚îú‚îÄ‚îÄ id (PK)
‚îú‚îÄ‚îÄ name
‚îú‚îÄ‚îÄ email
‚îú‚îÄ‚îÄ customer_type
‚îî‚îÄ‚îÄ ...

sales_transaction
‚îú‚îÄ‚îÄ id (PK)
‚îú‚îÄ‚îÄ sales_order_id (FK)
‚îú‚îÄ‚îÄ amount
‚îî‚îÄ‚îÄ ...
```

### HR Module Tables

```
employees
‚îú‚îÄ‚îÄ id (PK)
‚îú‚îÄ‚îÄ employee_id (UNIQUE)
‚îú‚îÄ‚îÄ first_name
‚îú‚îÄ‚îÄ last_name
‚îú‚îÄ‚îÄ department
‚îú‚îÄ‚îÄ manager_id (FK ‚Üí employees.id)
‚îî‚îÄ‚îÄ ...

attendance
‚îú‚îÄ‚îÄ id (PK)
‚îú‚îÄ‚îÄ employee_id (FK ‚Üí employees.id)
‚îú‚îÄ‚îÄ date
‚îú‚îÄ‚îÄ check_in_time
‚îî‚îÄ‚îÄ ...

leaves
‚îú‚îÄ‚îÄ id (PK)
‚îú‚îÄ‚îÄ employee_id (FK ‚Üí employees.id)
‚îú‚îÄ‚îÄ leave_type
‚îú‚îÄ‚îÄ status
‚îî‚îÄ‚îÄ ...

payrolls
‚îú‚îÄ‚îÄ id (PK)
‚îú‚îÄ‚îÄ employee_id (FK ‚Üí employees.id)
‚îú‚îÄ‚îÄ basic_salary
‚îú‚îÄ‚îÄ net_salary
‚îî‚îÄ‚îÄ ...
```

### Fleet Module Tables

```
vehicle
‚îú‚îÄ‚îÄ id (PK)
‚îú‚îÄ‚îÄ vehicle_number (UNIQUE)
‚îú‚îÄ‚îÄ vehicle_type
‚îú‚îÄ‚îÄ driver_name
‚îî‚îÄ‚îÄ ...

transport_job
‚îú‚îÄ‚îÄ id (PK)
‚îú‚îÄ‚îÄ dispatch_request_id (FK)
‚îú‚îÄ‚îÄ vehicle_no
‚îî‚îÄ‚îÄ ...
```

## Deployment Scenarios

### Scenario 1: Fresh Installation

```
New Device
    ‚Üì
Install Python & Dependencies
    ‚Üì
Configure .env file
    ‚Üì
Run: python app.py
    ‚Üì
‚úÖ All tables created automatically
‚úÖ Admin user created
‚úÖ Sample data added
‚úÖ Server running
```

### Scenario 2: Existing Database

```
Device with Existing Database
    ‚Üì
Run: python app.py
    ‚Üì
Migration checks existing tables
    ‚Üì
‚úÖ Skips existing tables
‚úÖ Creates only missing tables
‚úÖ Updates columns if needed
‚úÖ Server running
```

### Scenario 3: Partial Migration

```
Database with Some Tables
    ‚Üì
Run: python app.py
    ‚Üì
Migration checks each table
    ‚Üì
‚úÖ Skips: sales_order (exists)
‚úÖ Creates: employees (missing)
‚úÖ Updates: dispatch_request (new columns)
‚úÖ Server running
```

## Testing Strategy

### 1. Unit Test Migrations
```bash
python test_migrations.py
```
- Tests each migration individually
- Verifies table creation
- Checks row counts

### 2. Check Database Status
```bash
python test_migrations.py --status
```
- Lists all tables
- Shows row counts
- No modifications

### 3. Full Application Test
```bash
python app.py
```
- Runs complete initialization
- Tests in real environment
- Starts server

## Advantages

‚úÖ **Automatic** - No manual SQL scripts
‚úÖ **Idempotent** - Safe to run multiple times
‚úÖ **Centralized** - All migrations in one place
‚úÖ **Versioned** - Part of codebase
‚úÖ **Testable** - Can test before deployment
‚úÖ **Logged** - Clear output of what's happening
‚úÖ **Error-Tolerant** - Continues on non-critical errors
‚úÖ **Fast** - Completes in seconds

## Maintenance

### Adding New Tables

1. Add migration method to `MigrationManager`
2. Add to `run_all_migrations()` in correct order
3. Test with `python test_migrations.py`
4. Deploy - tables created automatically

### Modifying Existing Tables

1. Add column check in migration method
2. Use `ALTER TABLE` with existence check
3. Test on development database
4. Deploy - columns added automatically

### Removing Tables

1. Remove from migration (if new deployment)
2. For existing: Add DROP TABLE in migration
3. Or manually drop in production

## Troubleshooting Guide

### Issue: Foreign Key Constraint Fails
**Solution:** Check migration order - parent tables must be created first

### Issue: Column Already Exists
**Solution:** Add column existence check before ALTER TABLE

### Issue: Permission Denied
**Solution:** Grant CREATE TABLE privileges to database user

### Issue: Connection Refused
**Solution:** Check database is running and .env configuration

---

**This architecture ensures reliable, automatic database setup on any device!**